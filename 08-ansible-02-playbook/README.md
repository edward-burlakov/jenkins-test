# Домашнее задание к занятию "08.02 Работа с Playbook"

## Подготовка к выполнению
1. Создайте свой собственный (или используйте старый) публичный репозиторий на github с произвольным именем.
2. Скачайте [playbook](./playbook/) из репозитория с домашним заданием и перенесите его в свой репозиторий.
3. Подготовьте хосты в соответствии с группами из предподготовленного playbook. 
4. Скачайте дистрибутив [java](https://www.oracle.com/java/technologies/javase-jdk11-downloads.html) и положите его в директорию `playbook/files/`. 

## Основная часть
1. Приготовьте свой собственный inventory файл `prod.yml`.
2. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает kibana.
3. При создании tasks рекомендую использовать модули: `get_url`, `template`, `unarchive`, `file`.

---
### 4. Tasks должны: скачать нужной версии дистрибутив, выполнить распаковку в выбранную директорию, сгенерировать конфигурацию с параметрами.
   
       ПРИМЕЧАНИЕ:  Из-за недоступности сервера дистибутивов elastic.co  дистрибутивы скачаны 
       через VPN на другом сервере и такдже положены  в директорию  `playbook/files/`   домашнего задания `LESSON_8.1.`

---
### 5. Запускаем  `ansible-lint site.yml` и исправляем ошибки. Результат:

       root@ubuntu22:~/# ansible-lint site.yml
       WARNING  Overriding detected file kind 'yaml' with 'playbook' for given positional argument: site.yml
       root@ubuntu22:~/NETOLOGY/mnt-homeworks/08-ansible-02-playbook/playbook#

---
### 6. Запускаем playbook на этом окружении с флагом `--check`.


      root@ubuntu22:~/# ansible-playbook -i inventory/prod.yml site.yml --check

      PLAY [Install Java Developers Kit] **********************************************************************************************************************************

      TASK [Gathering Facts] **********************************************************************************************************************************************
      ok: [localhost]

      TASK [Set facts for Java 11 vars] ***********************************************************************************************************************************
      ok: [localhost]

      TASK [Upload .tar.gz file containing binaries from local storage] ***************************************************************************************************
      changed: [localhost]

      TASK [Ensure installation dir exists] *******************************************************************************************************************************
      changed: [localhost]

      TASK [Extract java in the installation directory] *******************************************************************************************************************
      skipping: [localhost]

      TASK [Export environment variables] *********************************************************************************************************************************
      ok: [localhost]

      PLAY [Install Elasticsearch] ****************************************************************************************************************************************

      TASK [Gathering Facts] **********************************************************************************************************************************************
      ok: [localhost]

      TASK [Upload tar.gz Elasticsearch from remote URL] ******************************************************************************************************************
      changed: [localhost]

      TASK [Create directrory for Elasticsearch] **************************************************************************************************************************
      ok: [localhost]

      TASK [Extract Elasticsearch in the installation directory] **********************************************************************************************************
      skipping: [localhost]

      TASK [Set environment Elastic] **************************************************************************************************************************************
      ok: [localhost]

      PLAY [Install Kibana] ***********************************************************************************************************************************************

      TASK [Gathering Facts] **********************************************************************************************************************************************
      ok: [localhost]

      TASK [Upload tar.gz Kibana from remote URL] *************************************************************************************************************************
      ok: [localhost]

      TASK [Create directrory Kibana] *************************************************************************************************************************************
      ok: [localhost]

      TASK [Extract Kibana in the installation directory] *****************************************************************************************************************
      skipping: [localhost]

      TASK [Set environment kibana] ***************************************************************************************************************************************
      ok: [localhost]

      PLAY RECAP **********************************************************************************************************************************************************
      localhost                  : ok=13   changed=3    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0


---
### 7. Запускаем  playbook на `prod.yml` окружении с флагом `--diff`. Убеждаемся, что изменения на системе произведены.

       root@ubuntu22:~/NETOLOGY/mnt-homeworks/08-ansible-02-playbook/playbook# ansible-playbook -i inventory/prod.yml site.yml --diff

       PLAY [Install Java Developers Kit] **********************************************************************************************************************************

       TASK [Gathering Facts] **********************************************************************************************************************************************
       ok: [localhost]

       TASK [Set facts for Java 11 vars] ***********************************************************************************************************************************
       ok: [localhost]

       TASK [Upload .tar.gz file containing binaries from local storage] ***************************************************************************************************
       --- before
       +++ after
       @@ -1,4 +1,4 @@
       {
       -    "mode": "0644",
       +    "mode": "0755",
            "path": "/tmp/jdk-11.0.17_linux-x64_bin.tar.gz"
       }

       changed: [localhost]

      TASK [Ensure installation dir exists] *******************************************************************************************************************************
      --- before
      +++ after
      @@ -1,4 +1,4 @@
      {
      -    "mode": "0755",
      +    "mode": "0644",
           "path": "/opt/jdk/11.0.17"
      }

      changed: [localhost]

      TASK [Extract java in the installation directory] *******************************************************************************************************************
      skipping: [localhost]

      TASK [Export environment variables] *********************************************************************************************************************************
      ok: [localhost]
 
      PLAY [Install Elasticsearch] ****************************************************************************************************************************************

      TASK [Gathering Facts] **********************************************************************************************************************************************
      ok: [localhost]

      TASK [Upload tar.gz Elasticsearch from remote URL] ******************************************************************************************************************
      --- before
      +++ after
      @@ -1,4 +1,4 @@
      {
      -    "mode": "0644",
      +    "mode": "0755",
           "path": "/tmp/elasticsearch-7.10.1-linux-x86_64.tar.gz"
      }

      changed: [localhost]

     TASK [Create directrory for Elasticsearch] **************************************************************************************************************************
     ok: [localhost]

     TASK [Extract Elasticsearch in the installation directory] **********************************************************************************************************
     skipping: [localhost]

     TASK [Set environment Elastic] **************************************************************************************************************************************
     ok: [localhost]

     PLAY [Install Kibana] ***********************************************************************************************************************************************

     TASK [Gathering Facts] **********************************************************************************************************************************************
     ok: [localhost]

     TASK [Upload tar.gz Kibana from remote URL] *************************************************************************************************************************
     ok: [localhost]

     TASK [Create directrory Kibana] *************************************************************************************************************************************
     ok: [localhost]

     TASK [Extract Kibana in the installation directory] *****************************************************************************************************************
     skipping: [localhost]

     TASK [Set environment kibana] ***************************************************************************************************************************************
     ok: [localhost]

     PLAY RECAP **********************************************************************************************************************************************************
     localhost                  : ok=13   changed=3    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0

---
### 8. Повторно запускаем  playbook с флагом `--diff` и убеждаемся, что playbook идемпотентен.


     root@ubuntu22:~/NETOLOGY/mnt-homeworks/08-ansible-02-playbook/playbook# ansible-playbook -i inventory/prod.yml site.yml --diff                                       
     PLAY [Install Java Developers Kit] **********************************************************************************************************************************

     TASK [Gathering Facts] **********************************************************************************************************************************************
     ok: [localhost]

     TASK [Set facts for Java 11 vars] ***********************************************************************************************************************************
     ok: [localhost]

     TASK [Upload .tar.gz file containing binaries from local storage] ***************************************************************************************************
     ok: [localhost]

    TASK [Ensure installation dir exists] *******************************************************************************************************************************
     ok: [localhost]

    TASK [Extract java in the installation directory] *******************************************************************************************************************
    skipping: [localhost]

    TASK [Export environment variables] *********************************************************************************************************************************
    ok: [localhost]

    PLAY [Install Elasticsearch] ****************************************************************************************************************************************

    TASK [Gathering Facts] **********************************************************************************************************************************************
    ok: [localhost]

    TASK [Upload tar.gz Elasticsearch from remote URL] ******************************************************************************************************************
    ok: [localhost]

    TASK [Create directrory for Elasticsearch] **************************************************************************************************************************
    ok: [localhost]

    TASK [Extract Elasticsearch in the installation directory] **********************************************************************************************************
    skipping: [localhost]

    TASK [Set environment Elastic] **************************************************************************************************************************************
    ok: [localhost]

    PLAY [Install Kibana] ***********************************************************************************************************************************************

    TASK [Gathering Facts] **********************************************************************************************************************************************
    ok: [localhost]

    TASK [Upload tar.gz Kibana from remote URL] *************************************************************************************************************************
    ok: [localhost]

    TASK [Create directrory Kibana] *************************************************************************************************************************************
    ok: [localhost]

    TASK [Extract Kibana in the installation directory] *****************************************************************************************************************
    skipping: [localhost]

    TASK [Set environment kibana] ***************************************************************************************************************************************
    ok: [localhost]

    PLAY RECAP **********************************************************************************************************************************************************
    localhost                  : ok=13   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0


9. Подготовьте README.md файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги.



